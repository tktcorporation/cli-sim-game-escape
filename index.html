<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link data-trunk rel="rust" />
    <title>Escape Room - 脱出ゲーム</title>
    <style>
      body {
        margin: 0;
        width: 100%;
        height: 100vh;
        height: 100dvh;
        background-color: #0a0a0a;
        overflow: hidden;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }
      body > div {
        margin: 0 auto;
      }
      pre {
        font-family: "Fira Code", "Courier New", monospace;
        font-size: 14px;
        touch-action: manipulation;
        cursor: default;
      }
      @media (max-width: 600px) {
        pre {
          font-size: 11px;
        }
      }
      @media (max-width: 400px) {
        pre {
          font-size: 9px;
        }
      }
    </style>
  </head>
  <body></body>
  <script>
    // Standard click handler: parse action keys from clicked <pre> text content
    // and dispatch corresponding keyboard events for ratzilla's on_key_event handler.
    function handleClickOrTap(clientX, clientY) {
      var el = document.elementFromPoint(clientX, clientY);
      if (!el) return;
      // Walk up to find a <pre> element (ratzilla renders each row as <pre>)
      while (el && el.tagName !== 'PRE') {
        el = el.parentElement;
      }
      if (!el) return;
      var text = el.textContent || '';
      // Match action keys like [1], [2], [N], [S], [I], [R], [H]
      var match = text.match(/\[([1-9A-Za-z])\]/);
      if (!match) return;
      var key = match[1].toLowerCase();
      document.dispatchEvent(new KeyboardEvent('keydown', {
        key: key,
        code: 'Key' + key.toUpperCase(),
        bubbles: true
      }));
    }

    document.addEventListener('click', function(e) {
      handleClickOrTap(e.clientX, e.clientY);
    });

    document.addEventListener('touchstart', function(e) {
      if (e.touches.length > 0) {
        var touch = e.touches[0];
        handleClickOrTap(touch.clientX, touch.clientY);
      }
    }, { passive: true });
  </script>
</html>
