# Cookie Factory 拡張設計

## 概要

Cookie Factoryに以下の3つの機能を追加する：
1. **新生産者4種** — 数兆規模までのスケール拡張
2. **ROI表示** — 投資効率の可視化
3. **演出強化** — フィードバックの改善

---

## 1. 新生産者（4種追加）

### 基本スペック

| 生産者 | 基本コスト | 基本CPS | コンセプト |
|--------|----------|---------|-----------|
| Alchemy Lab | 5.1B | 260,000 | 素材を黄金クッキーに変換 |
| Portal | 75B | 1,600,000 | 異次元からクッキーを召喚 |
| Time Machine | 1.1T | 9,800,000 | 過去の無限クッキーを収穫 |
| Antimatter Condenser | 17T | 64,000,000 | 反物質エネルギーで生成 |

### シナジー設計

#### 円形シナジー（延長）

既存の円形シナジーを延長する：

```
... → Shipment → Alchemy Lab → Portal → Time Machine → Antimatter Condenser → Cursor
```

- 各生産者が次の生産者に+2〜5%ボーナス（既存パターン継続）

#### ツリー型シナジー（新規）

上位生産者が特定の下位生産者を強化する：

| 生産者 | 強化対象 | 効果 | 世界観 |
|--------|---------|------|--------|
| Alchemy Lab | Mine, Farm | 各+15% | 素材を黄金に変える |
| Portal | Temple, WizardTower | 各+20% | 異次元の魔力を引き出す |
| Time Machine | Cursor, Grandma, Farm | 各+10% | 過去の効率を現在に |
| Antimatter Condenser | Factory, Shipment | 各+25% | 無限エネルギー供給 |

### 戦略的な狙い

- 下位生産者が「死に要素」にならない（上位生産者が下位を強化）
- 「どの上位生産者を先に取るか」で下位の価値が変わる
- 組み合わせを考える楽しさが生まれる

---

## 2. ROI表示

### 表示する情報

| 項目 | 表示例 | 意味 |
|------|--------|------|
| CPS効率 | `効率: 0.0067` | CPS ÷ コスト（高いほど効率的） |
| 回収時間 | `回収: 2分30秒` | コスト ÷ 追加CPS（投資が元を取る時間） |
| 推奨度 | `★★★` | 現在の状況での購入推奨度 |

### 表示位置

- **ワイド版**: `Cursor [15] 0.1/s 効率:0.007 回収:2:30 ★★☆`
- **ナロー版**: `Cursor [15] ★★☆`（効率・回収時間は省略）

### 推奨度の計算ロジック

```
★★★ = 回収時間が最短 or 効率が最高
★★☆ = 回収時間が平均以下
★☆☆ = 回収時間が平均以上
☆☆☆ = 現在買えない or 非効率
```

### 狙い

- 「今何を買うべきか」が一目でわかる
- ただし★が絶対正解ではない（シナジー考慮は手動判断）
- 情報を与えつつ、戦略的判断の余地を残す

---

## 3. 演出強化

### クリック演出

| 要素 | 内容 |
|------|------|
| クリック時 | `+1` → `+5` などの数字を一瞬表示 |
| 大量獲得時 | ゴールデンクッキーで `+1,234!` と強調表示 |
| コンボ | 連続クリックで数字の色が変化（白→黄→赤） |

### 生産フィードバック

| 要素 | 内容 |
|------|------|
| CPS表示 | 現在のCPSをリアルタイムでアニメーション更新 |
| 生産者購入時 | `▶ Cursor +1!` のようなログ表示（数秒で消える） |
| マイルストーン達成 | `★ 達成: 100クッキー生産!` の通知 |

### ゴールデンクッキー演出

| 要素 | 内容 |
|------|------|
| 出現時 | `[G]` が点滅（既存を強化） |
| 獲得時 | バフ内容を画面中央に大きく表示 |
| バフ中 | ステータス欄の色が変化（通常→金色系） |

### 実装の優先度

1. クリック時の `+N` 表示（効果実感）
2. 購入時のログ表示（行動のフィードバック）
3. ゴールデンクッキー演出強化

---

## 実装順序

1. **新生産者の追加** — state.rs, logic.rs に4種追加
2. **シナジーの実装** — 円形シナジー延長 + ツリー型シナジー
3. **新生産者のアップグレード** — ×2, ×3 などの基本アップグレード
4. **ROI計算ロジック** — logic.rs に効率・回収時間の計算関数
5. **ROI表示** — render.rs に表示追加
6. **演出強化** — state.rs にイベントログ追加、render.rs で表示

---

## 技術的な注意点

- Pure Logic パターンを維持（state/logic/render の分離）
- 既存のテストを壊さない
- 新機能には対応するテストを追加
- ナロー/ワイドレイアウト両対応
